---
title: "Full_Nutrient_Models"
author: "Hannah Merges"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning=FALSE, 
                      message=FALSE)
```

## Loading libraries 

```{r, echo=FALSE}
library(LoLinR)
library(lubridate)
library(patchwork)
library(tidyverse)
library(here)
library(car)
library(GGally)
library(corrplot)
library(PNWColors)
library(seacarb)
library(broom)
library(agricolae)
library(lme4)
library(lmerTest)
library(modelsummary)
library(performance)
library(emmeans)
library(MuMIn)
```

## Loading Data
```{r}
pHSlope <- read_csv(here("Data", "pHSlope.csv")) ## manually deleted BLANK DATA on MAY 30th 
calc.data <- read_csv(here("Data", "Titrations", "Calc_TArates.csv"))
full_calc_data <- read_csv(here("Data", "full_calc_data.csv"))
#RespoR_Normalized_Full_ExcelUpdates <- read_csv(here::here("Data","RespoFiles", "Respo_RNormalized_AllRates.csv"))
NEC_wnuts <- read_csv(here("Data", "NECnuts_withpH.csv"))
FULL_RespoNEC_allParams <- read_csv(here("Data", "RespoR_Normalized_Full_withNEC_ExcelUpdates.csv"))
```

#Timeline Updates
RespoR_Normalized_Full_withNEC_ExcelUpdates.csv = HAS NUTRIENT DATA FOR GP but is a little wonky - should go back and check join issues 

## Tidy the dataframes and play around with them to explore data
calculated mean, sd and var --- maybe this is something to come back to as of May 31st?? 

```{r}
## calculate mean, variances, and sd of O2 rates so we have that work with just in case
RespoR_Normalized_Full_meanvar <- RespoR_Normalized_Full_ExcelUpdates %>% 
  group_by(SGD_number, site, P_R) %>% 
  summarize(mean_umol = mean(umol.cm2.hr, na.rm=TRUE), 
            var_umol = var(umol.cm2.hr, na.rm=TRUE), 
            sd_umol = sd(umol.cm2.hr, na.rm = TRUE)) %>% 
  filter(!is.infinite(mean_umol))

RespoR_Normalized_Full2 <- RespoR_Normalized_Full_ExcelUpdates %>% 
  left_join(RespoR_Normalized_Full_meanvar, join_by(SGD_number, site, P_R))

## for calc data as well 
full.calc.data_meanvar <- full_calc_data %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  group_by(SGD_number, site) %>% 
  summarize(mean_umol = mean(umol.cm2.hr, na.rm=TRUE), 
            var_umol = var(umol.cm2.hr, na.rm=TRUE), 
            sd_umol = sd(umol.cm2.hr, na.rm = TRUE))

### and with the NEC_nuts df 
full.calc.data_meanvar_withnuts <- NEC_wnuts %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  group_by(SGD_number, site) %>% ## this groups all the 8 replicates together for one average 
  summarize(mean_umol = mean(umol.cm2.hr, na.rm=TRUE), 
            var_umol = var(umol.cm2.hr, na.rm=TRUE), 
            sd_umol = sd(umol.cm2.hr, na.rm = TRUE))

```

# THINGS TO CONSIDER: 
- N and NH4 might be nonlinear for Respiration rates 
- drop outliers (have dropped specific outliers for Env params)
- no signif. nonlinear trend, UNLESS remove random effects 
- report R2 marginal and conditional 
- try nonlinear and linear, with and without random effects
- NN at Varari looks close and maybe P or silicate at Cabral

Note: initial TA was measured AFTER the 12 hours of soaking whereas nutrients were measured at the beginning of the 12 hours right when mixtures were created. pH is also calculated based on measurements taken *WHEN* (before or after 12 hours??)
- have added new_pH in and re-run models 

# PLOT CENTRAL: series of plots for each physio measurement (R, GP, NP, NEC) per each env param (sal, pH, NN, phos, silicate, ammonia, and TBD on TA)
Goal: create models to see if specific nutrients have an effect on the O2 rates 

### starting with VARARI, RESPIRATION - updated on May 30th 
```{r}
RespoR_Normalized_Full_ExcelUpdates <- FULL_RespoNEC_allParams %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         salinity=as.numeric(salinity), 
         TA_initial=as.numeric(TA_initial),
         umol.cm2.hr=as.numeric(umol.cm2.hr))

Nutrient_Models_Varari_R <- RespoR_Normalized_Full_ExcelUpdates %>% 
  filter(site=="Varari") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="R") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         salinity=as.numeric(salinity), 
         TA_initial=as.numeric(TA_initial),
         umol.cm2.hr=as.numeric(umol.cm2.hr))

Nutrient_Models_Varari_R<-Nutrient_Models_Varari_R[-c(47),]  ## removes the outlier (really low value) -- CHECK THIS - good as of June 1st

#######################
## NN ## 
########################
NNbyRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         SGD_number=as.factor(SGD_number)) %>% 
 # filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") + 
  labs(x = "N+N (umolL)",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "N+N for Varari") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "NN_plot.jpg"), 
       width = 10, height = 7)

## normal model with full nesting and random effects 
Varari_NN_resp <- lmer(data = Nutrient_Models_Varari_R, 
             umol.cm2.hr ~ poly(NN_umolL, degree=2) + (1|date/new_colonynumber))

anova(Varari_NN_resp) 
summary(Varari_NN_resp)

#######################
## NH4 ## 
########################
NH4byRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         SGD_number=as.factor(SGD_number)) %>% 
 # filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  labs(x = "NH4 (umolL)",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NH4 for Varari") +
 # facet_wrap(~date, scales = "free_x") + 
   theme(axis.text.x=element_text(size=6), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))

NH4byRplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "NH4_plot.jpg"), 
       width = 10, height = 7)

### model 
Nutrient_Models_Varari_R$umol.cm2.hr <- as.numeric(Nutrient_Models_Varari_R$umol.cm2.hr)
Nutrient_Models_Varari_R$ammonia_umolL <- as.numeric(Nutrient_Models_Varari_R$ammonia_umolL)

Varari_NH4_resp <- lmer(data = Nutrient_Models_Varari_R, 
             umol.cm2.hr ~ poly(ammonia_umolL, degree=2) + (1|date/new_colonynumber))

anova(Varari_NH4_resp) 
summary(Varari_NH4_resp)

#######################
## PO4 ## 
########################
PhosbyRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
 # filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #facet_wrap(~date, scales = "free_x") + 
  labs(x = "Respiration Rates with Phosphate (umolL)",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "Phosphate for Varari") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
PhosbyRplot
ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "PO4_plot.jpg"), 
       width = 10, height = 7)

Varari_PO4_resp <- lmer(data = Nutrient_Models_Varari_R, 
             umol.cm2.hr ~ poly(phosphate_umolL, degree=2) + (1|date/new_colonynumber))

anova(Varari_PO4_resp) 
summary(Varari_PO4_resp)


#######################
## SiO3 ## 
########################
SilicatebyRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
 # filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
 # facet_wrap(~date, scales = "free_x") +
  labs(x = "Silicate (umolL)",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "Respiration Rates for Varari with Silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
SilicatebyRplot
ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "SiO4_plot.jpg"), 
       width = 10, height = 7)

Varari_SiO4_resp <- lmer(data = Nutrient_Models_Varari_R, 
             umol.cm2.hr ~ poly(silicate_umolL, degree=2) + (1|date/new_colonynumber))

anova(Varari_SiO4_resp) 
summary(Varari_SiO4_resp)

#######################
## pH ## 
########################
pHbyRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "Respiration Rates for Varari with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyRplot
ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "pH_plot.jpg"), 
       width = 10, height = 7)

Varari_pH_resp <- lmer(data = Nutrient_Models_Varari_R, 
             umol.cm2.hr ~ poly(new_pH, degree=2) + (1|date/new_colonynumber))

anova(Varari_pH_resp) 
summary(Varari_pH_resp)

#######################
## salinity ## 
########################
salinitybyRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "Respiration Rates for Varari with salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salinitybyRplot
ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "salinity_plot.jpg"), 
       width = 10, height = 7)

Varari_sal_resp <- lmer(data = Nutrient_Models_Varari_R, 
             umol.cm2.hr ~ poly(salinity, degree=2) + (1|date/new_colonynumber))

anova(Varari_sal_resp) 
summary(Varari_sal_resp)

#######################
## TA ## 
########################
TAbyRplot <- Nutrient_Models_Varari_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
 # filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #facet_wrap(~date, scales = "free_x") + 
  labs(x = "Respiration Rates with TA (umolL)",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "TA for Varari") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyRplot
ggsave(here("Outputs", "NutrientAnalyses", "Varari", "Respiration", "TA_plot.jpg"), 
       width = 10, height = 7)





```

### Varari NP plots with nutrients 

```{r}
###  make new dataset 
Nutrient_Models_Varari_NP <- FULL_RespoNEC_allParams %>% 
  filter(site=="Varari") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="NP") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         salinity=as.numeric(salinity), 
         TA_initial=as.numeric(TA_initial),
         umol.cm2.hr=as.numeric(umol.cm2.hr))


## pH 
pHbyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "pH_plot.jpg"), 
       width = 10, height = 7)


## salinity 
salinitybyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "salinity",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salinitybyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "sal_plot.jpg"), 
       width = 10, height = 7)


## phosphate 
phosphatebyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "Phosphate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with Phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
phosphatebyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "phosphate_plot.jpg"), 
       width = 10, height = 7)

## nitrates 
NNbyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "NN_plot.jpg"), 
       width = 10, height = 7)

## silicate 
silicatebyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "Silicate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "silicate_plot.jpg"), 
       width = 10, height = 7)


## silicate 
ammoniabyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "Ammonia",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with Ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "ammonia_plot.jpg"), 
       width = 10, height = 7)


## TA 
TAbyNPplot <- Nutrient_Models_Varari_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Varari with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "NetPhotosynthesis", "TA_plot.jpg"), 
       width = 10, height = 7)



```

#### Varari GP for each nutrient

```{r}
Nutrient_Models_Varari_GP <- FULL_RespoNEC_allParams %>% 
  filter(site=="Varari") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="GP") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         TA_initial=as.numeric(TA_initial),
         salinity=as.numeric(salinity), 
         umol.cm2.hr=as.numeric(umol.cm2.hr))


## pH 
pHbyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "pH_plot.jpg"), 
       width = 10, height = 7)

## TA 
TAbyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "TA_plot.jpg"), 
       width = 10, height = 7)

## salinity 
salinitybyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "salinity",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salinitybyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "salinity_plot.jpg"), 
       width = 10, height = 7)

## ammonia 
ammoniabyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "ammonia",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "ammonia_plot.jpg"), 
       width = 10, height = 7)

## silicate 
silicatebyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "silicate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "silicate_plot.jpg"), 
       width = 10, height = 7)

## NN 
NNbyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "NN_plot.jpg"), 
       width = 10, height = 7)

## phosphate 
phosphatebyGPplot <- Nutrient_Models_Varari_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "phosphate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Varari with phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
phosphatebyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Varari", "GrossPhotosynthesis", "phosphate_plot.jpg"), 
       width = 10, height = 7)

```


### For Calcification for Varari 
Just do SGD dils here to see how compares to original plots 

# V NEC by general SGD dils 
```{r}
SGDdilsbyVplot <- NEC_wnuts %>% 
  filter(site=="Varari") %>% 
  filter(sample_ID_edit!="Varari_Col4_Dil9_Light_Day2") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number),
         umol.cm2.hr=as.numeric(umol.cm2.hr)) %>% 
  ggplot(aes(x=SGD_number, 
             y=umol.cm2.hr, 
             color=as.factor(SGD_number))) + 
  geom_point(size=4) +
  theme_bw() + 
  geom_smooth(method = "lm", se=TRUE, color="black") +
  geom_hline(yintercept = 0) +
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "SGD Dils",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with SGD Dils") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
SGDdilsbyVplot 


SGDdilsbyVplot2 <- NEC_wnuts %>% 
  filter(site=="Varari") %>% 
  filter(sample_ID_edit!="Varari_Col4_Dil9_Light_Day2") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=log(SGD_number+1), 
             y=umol.cm2.hr, 
             color=as.factor(new_colonynumber))) + 
  geom_point(size=4) +
  scale_color_manual(values=rev(pnw_palette("Bay", n=9)), 
                     guide="none") +
  theme_bw() + 
  theme(strip.background = element_rect(fill = "white")) +
  geom_smooth(method = "lm", color="black") +
  geom_hline(yintercept = 0) +
  labs(x = "log SGD Dils",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with SGD Dils") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
SGDdilsbyVplot2

  
```

## V NEC for each nutrient 
```{r}
Nutrient_Models_Varari_NEC <- FULL_RespoNEC_allParams %>% 
  filter(site=="Varari") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="C") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         TA_initial=as.numeric(TA_initial),
         salinity=as.numeric(salinity), 
         umol.cm2.hr=as.numeric(umol.cm2.hr))

## ammonia 
ammoniabyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "ammonia",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with Ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbyAmmonia.jpg"))


### silicate
silicatebyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "silicate",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with Silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbySilicate.jpg"))


### NN
NNbyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbyNN.jpg"))


### Phos
PhosbyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  filter(phosphate_umolL<1) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
# facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "Phosphate",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with Phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
PhosbyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbyPhosphate.jpg"))

### pH 
pHbyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
  #facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbypH.jpg"))


### salinity 
SalinitybyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  filter(phosphate_umolL<1) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
 # facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "Salinity",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with Salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
SalinitybyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbySalinity.jpg"))


### TA 
TAbyVplot <- Nutrient_Models_Varari_NEC  %>% 
  drop_na(umol.cm2.hr) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
  #facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Varari with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyVplot
ggsave(here::here("Outputs", "NutrientAnalyses", "Varari", "Calcification", "NECbyTA.jpg"))

```

## quick visualization of TA at both sites 
TA is significant (0.002)
```{r}
### plot both sites together for NEC Phos
TA_bothsites <- FULL_RespoNEC_allParams  %>% 
  drop_na(umol.cm2.hr) %>% 
  filter(phosphate_umolL<1) %>% 
  filter(P_R=="C") %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
   ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #scale_color_manual(values=pnw_palette("Sailboat")) +
# facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Both Sites with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TA_bothsites


linearmod_bothsites_TA <- lmer(umol.cm2.hr ~ TA_initial + (1|new_colonynumber), 
                               data=FULL_RespoNEC_allParams  %>%
                                 filter(umol.cm2.hr!="Inf") %>%
                                 filter(P_R=="C"))

anova(linearmod_bothsites_TA)

```

### Cabral NP plots 
```{r}
Nutrient_Models_Cabral_NP <- FULL_RespoNEC_allParams %>% 
  filter(site=="Cabral") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="NP") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         TA_initial=as.numeric(TA_initial),
         salinity=as.numeric(salinity), 
         umol.cm2.hr=as.numeric(umol.cm2.hr))

## pH 
pHbyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "pH_plot.jpg"), 
       width = 10, height = 7)


## salinity 
salbyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "salinity",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "salinity_plot.jpg"), 
       width = 10, height = 7)


## phosphate 
phosphatebyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "phosphate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
phosphatebyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "phosphate_plot.jpg"), 
       width = 10, height = 7)


## phosphate 
phosphatebyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "phosphate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
phosphatebyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "phosphate_plot.jpg"), 
       width = 10, height = 7)

## ammonia 
ammoniabyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "ammonia",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "ammonia_plot.jpg"), 
       width = 10, height = 7)

## NN 
NNbyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "NN_plot.jpg"), 
       width = 10, height = 7)

## silicate 
silicatebyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "silicate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "silicate_plot.jpg"), 
       width = 10, height = 7)

## TA 
TAbyNPplot <- Nutrient_Models_Cabral_NP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NP Rates for Cabral with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyNPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "NetPhotosynthesis", "TA_plot.jpg"), 
       width = 10, height = 7)

```

### Cabral R plots 
```{r}
Nutrient_Models_Cabral_R <- FULL_RespoNEC_allParams %>% 
  filter(site=="Cabral") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="R") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         TA_initial=as.numeric(TA_initial),
         salinity=as.numeric(salinity), 
         umol.cm2.hr=as.numeric(umol.cm2.hr))


## pH 
pHbyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "pH_plot.jpg"), 
       width = 10, height = 7)

## TA 
TAbyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "TA_plot.jpg"), 
       width = 10, height = 7)


## salinity 
salinitybyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "salinity",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salinitybyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "salinity_plot.jpg"), 
       width = 10, height = 7)


## phosphate 
phosphatebyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "phosphate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
phosphatebyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "phosphate_plot.jpg"), 
       width = 10, height = 7)



## ammonia 
ammoniabyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "ammonia",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "ammonia_plot.jpg"), 
       width = 10, height = 7)


## NN 
NNbyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "NN_plot.jpg"), 
       width = 10, height = 7)


## silicate 
silicatebyRplot <- Nutrient_Models_Cabral_R %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "silicate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "R Rates for Cabral with silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyRplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Respiration", "silicate_plot.jpg"), 
       width = 10, height = 7)
```

### Cabral GP plots
```{r}
Nutrient_Models_Cabral_GP <- FULL_RespoNEC_allParams %>% 
  filter(site=="Cabral") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="GP") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         TA_initial=as.numeric(TA_initial),
         salinity=as.numeric(salinity), 
         umol.cm2.hr=as.numeric(umol.cm2.hr))

## pH 
pHbyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "pH_plot.jpg"), 
       width = 10, height = 7)


### TA 
TAbyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "TA_plot.jpg"), 
       width = 10, height = 7)

## salinity 
salinitybyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "salinity",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salinitybyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "salinity_plot.jpg"), 
       width = 10, height = 7)

## phosphate 
phosphatebyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "phosphate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
phosphatebyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "phosphate_plot.jpg"), 
       width = 10, height = 7)

## ammonia 
ammoniabyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "ammonia",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "ammonia_plot.jpg"), 
       width = 10, height = 7)

## NN 
NNbyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "NN_plot.jpg"), 
       width = 10, height = 7)

## silicate 
silicatebyGPplot <- Nutrient_Models_Cabral_GP %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "silicate",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "GP Rates for Cabral with silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyGPplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "GrossPhotosynthesis", "silicate_plot.jpg"), 
       width = 10, height = 7)

```

### Cabral NEC plots 
```{r}
Nutrient_Models_Cabral_NEC <- FULL_RespoNEC_allParams %>% 
  filter(site=="Cabral") %>% 
  drop_na(NN_umolL) %>% 
  filter(P_R=="C") %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         NN_umolL=as.numeric(NN_umolL), 
         ammonia_umolL=as.numeric(ammonia_umolL), 
         silicate_umolL=as.numeric(silicate_umolL), 
         phosphate_umolL=as.numeric(phosphate_umolL), 
         new_pH=as.numeric(new_pH), 
         SGD_number=as.factor(SGD_number), 
         TA_initial=as.numeric(TA_initial),
         salinity=as.numeric(salinity), 
         umol.cm2.hr=as.numeric(umol.cm2.hr))


## just by SGD dilutions first 
SGDdilsbyCplot <- NEC_wnuts %>% 
  filter(site=="Cabral") %>% 
  filter(umol.cm2.hr<1) %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  ggplot(aes(x=log(SGD_number+1), 
             y=umol.cm2.hr, 
             color=as.factor(new_colonynumber))) + 
  geom_point(size=4) +
  scale_color_manual(values=rev(pnw_palette("Bay", n=9)), 
                     guide="none") +
  theme_bw() + 
  theme(strip.background = element_rect(fill = "white")) +
  geom_smooth(method = "lm", color="black") +
  geom_hline(yintercept = 0) +
  labs(x = "log SGD Dils",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with SGD Dils") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
SGDdilsbyCplot

## ammonia 
ammoniabyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=ammonia_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "ammonia",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with ammonia") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
ammoniabyCplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbyAmmonia.jpg"), 
       width = 10, height = 7)


### silicate
silicatebyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=silicate_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "Silicate",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with Silicate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
silicatebyCplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbySilicate.jpg"), 
       width = 10, height = 7)


### NN
NNbyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=NN_umolL, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "NN",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with NN") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NNbyCplot
ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbyNN.jpg"), 
       width = 10, height = 7)

### Phos
PhosbyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=phosphate_umolL, 
             y=umol.cm2.hr)) + 
  geom_point(size=3, aes(color=new_colonynumber)) +
  geom_smooth(method="lm") +
  theme_bw() + 
  #facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "Phosphate",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with Phosphate") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
PhosbyCplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbyPhosphate.jpg"), 
       width = 10, height = 7)

###### salinity 
salinitybyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=salinity, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "salinity",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with Salinity") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
salinitybyCplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbySalinity.jpg"), 
       width = 10, height = 7)

###### pH 
pHbyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=new_pH, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
  #facet_wrap(~new_colonynumber, scales = "free_x") +
  labs(x = "pH",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with pH") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
pHbyCplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbypH.jpg"), 
       width = 10, height = 7)

## TA
TAbyCplot <- Nutrient_Models_Cabral_NEC %>% 
  mutate(new_colonynumber= as.factor(new_colonynumber), 
         date=as.factor(date), 
         SGD_number=as.factor(SGD_number)) %>% 
  ggplot(aes(x=TA_initial, 
             y=umol.cm2.hr, 
             color=new_colonynumber)) + 
  geom_point(size=3) +
  theme_bw() + 
#  facet_wrap(~date, scales = "free_x") +
  labs(x = "TA",
       y = "Rate (umol CaCO3 g-1 hr-1)",
       title = "NEC Rates for Cabral with TA") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
TAbyCplot

ggsave(here("Outputs", "NutrientAnalyses", "Cabral", "Calcification", "NECbyTA.jpg"), 
       width = 10, height = 7)


#############################
## just the SGD dilution plots 
#############################

SGDdilsbyCplot + SGDdilsbyVplot2
ggsave(here::here("Outputs", "NutrientAnalyses", "CabralandVarari_NEC_bySGDDils.jpg"), 
       width=12, height=7)

```


quick model selection 
```{r}
NEC_wnuts_V <- NEC_wnuts %>% 
  filter(site=="Varari") %>% 
  drop_na(umol.cm2.hr) %>% 
  filter(!is.infinite(umol.cm2.hr))

NEC_wnuts_C <- NEC_wnuts %>% 
  filter(site=="Cabral") %>% 
  drop_na(umol.cm2.hr) %>% 
  filter(!is.infinite(umol.cm2.hr))


## varari 
Varari_SGD_NEC <- lmer(data = NEC_wnuts_V, 
             umol.cm2.hr ~ SGD_number + (1|date/new_colonynumber))
summary(Varari_SGD_NEC)

## cabral 
Cabral_SGD_NEC <- lmer(data = NEC_wnuts_C, 
             umol.cm2.hr ~ SGD_number + (1|date/new_colonynumber))
summary(Cabral_SGD_NEC)



```


### Take the average of all replicates per SGD treatment to get one value per treatment and plot - May 31st 
```{r}

NEC_wnuts_averaged <- NEC_wnuts %>%
  filter(sample_ID_edit!="Varari_Col4_Dil9_Light_Day2") %>% 
  drop_na(umol.cm2.hr) %>% 
  filter(!is.infinite(umol.cm2.hr)) %>% 
  filter(umol.cm2.hr<1) %>% 
  group_by(site, SGD_number) %>% 
  summarize(avg_umol = mean(umol.cm2.hr))

### plot for Varari and Cabral 
NECby_avgSGDdils_plot <- NEC_wnuts_averaged %>%
  #filter(site=="Varari") %>% 
  ggplot(aes(x=log(SGD_number+1), 
             y=avg_umol, 
             color=as.factor(SGD_number))) + 
  geom_point(size=4) +
  scale_color_manual(values=rev(pnw_palette("Bay", n=9)), 
                     guide="none") +
  theme_bw() + 
 # theme(strip.background = element_rect(fill = "white")) +
  geom_smooth(method="lm", formula="y~poly(x,2)", color="black") +
  geom_hline(yintercept = 0) +
  facet_wrap(~site) +
  labs(x = "log SGD Dils",
       y = "Rate (umol O2 cm2 hr-1)",
       title = "NEC Rates for averaged SGD Dils") +
   theme(axis.text.x=element_text(size=18), 
        axis.text.y=element_text(size=18), 
        axis.title.x=element_text(size=18),
        axis.title.y=element_text(size=18), 
        plot.title=element_text(hjust=0.5, ## centers title 
                                size=20))
NECby_avgSGDdils_plot
ggsave(here::here("Outputs", "NutrientAnalyses", "NEC_SGDavg_bothsites.jpg"))

#########################################
### run models on the averaged SGD dils bc Varari looks nonlinear
#########################################
NEC_wnuts_averaged_V <- NEC_wnuts_averaged %>% 
  filter(site=="Varari")

NEC_wnuts_averaged_C <- NEC_wnuts_averaged %>% 
  filter(site=="Cabral")


## varari 
Varari_avgSGD_NEC <- lm(avg_umol ~ SGD_number, data = NEC_wnuts_averaged_V)
summary(Varari_avgSGD_NEC)

Varari_avgSGD_NEC2 <- lm(avg_umol ~ poly(SGD_number, degree=2), data = NEC_wnuts_averaged_V)
summary(Varari_avgSGD_NEC2)

## cabral 
Cabral_avgSGD_NEC <- lm(avg_umol ~ SGD_number, data = NEC_wnuts_averaged_C)
summary(Cabral_avgSGD_NEC)


```



### Results to share with Nyssa: (June 6th) 
- after going through the data AGAIN in depth and resolving join issues -- with new NEC models, initial TA is significant 


